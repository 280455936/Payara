<!DOCTYPE html>
<html>
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.css" rel="stylesheet" type="text/css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.min.js"></script>

    <style>
        body { margin: 2em; }
    </style>
</head>
<body>

<h1>Monitoring Console</h1>

Series: <select id="options"></select>

<div style="display: inline-block; width: 600px; border: 2px solid #ccc;">
    <canvas id="myChart" width="2" height="1"></canvas>
</div>

<script>
var options = $("#options");
$.getJSON("api/points/series/", function(response) {
     $.each(response, function() {
     options.append($("<option />").val(this.replace(/ /g, ',')).text(this));
 });
});

var refresher;
var chart;

$('select').on('change', function() {
	var selectedSeries = this.value;
	if (refresher) {
		clearInterval(refresher);
	}
    var ctx = $('#myChart');
    chart = new Chart(ctx, {
        type: 'line',
        data: {
            datasets: [ { label: 'line 1', borderColor: 'red', data: [] }],
        },
        options: {
            scales: {
                xAxes: [{
                    type: 'time',
                    time: {
                        unit: 'second'
                    }
                }]
            }
        }
    });
	
	refresher = setInterval(updateSeries, 1000, selectedSeries);
});

function updateSeries(series) {
	$.getJSON('api/points/series/' + series, function(data) {
		if (data) {
		    for (var i = 0; i < data.length; i++) {
		        data[i].t = new Date(data[i].time);
		        data[i].y = data[i].value;
		    }
		}
	    chart.data.datasets[0].data = data;
	    chart.update(0);
	});
} 
</script>

</body>
</html>
